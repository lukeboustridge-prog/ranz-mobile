---
phase: 11-camera-gps-capture
plan: 06
type: execute
wave: 4
depends_on: ["11-02", "11-03", "11-04", "11-05"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Captured photo contains GPS coordinates in EXIF readable by external tools"
    - "GPS accuracy indicator displays in camera UI"
    - "Location validation alerts when capture far from property"
    - "Permissions are requested appropriately on both platforms"
  artifacts: []
  key_links: []
---

<objective>
Verify Phase 11 Camera + GPS Capture implementation

Purpose: Validate all Phase 11 success criteria are met through functional testing.

Output:
- Verification checklist completion
- Documented evidence that requirements are satisfied
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
Phase 11 Success Criteria from ROADMAP:
1. Captured photo contains GPS coordinates in EXIF metadata readable by external tools
2. Captured photo contains capture timestamp in EXIF metadata
3. GPS accuracy value is displayed in capture UI so inspector knows signal quality
4. Location validation alerts inspector if capture location is far from property address
5. Camera and location permissions are requested appropriately on both iOS and Android

Requirements:
- EVID-01: Inspector can capture photo with GPS coordinates preserved in EXIF
- EVID-02: Inspector can capture photo with timestamp preserved in EXIF
- EVID-03: Inspector can capture photo with camera serial/model preserved in EXIF
- LOCN-01: App tracks GPS coordinates during inspection session
- LOCN-02: GPS accuracy value captured alongside coordinates
- LOCN-03: GPS accuracy indicator visible in capture UI
- LOCN-04: Location validated against expected property address
- PLAT-03: App handles iOS HEIC photo format correctly
- PLAT-04: App handles iOS and Android permission models
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Phase 11 Camera + GPS Capture implementation</what-built>
  <how-to-verify>

## Build and Run the App

1. Start Metro bundler and run on device/simulator:
   ```bash
   cd ranz-mobile
   npm start
   ```

2. Run on iOS simulator or Android emulator

## Verification Checklist

### 1. Permission Handling (PLAT-04)

- [ ] App requests camera permission on first camera access
- [ ] App requests location permission on first camera access
- [ ] Permission denied shows helpful guidance to enable in Settings
- [ ] "Open Settings" button works
- [ ] (iOS) Approximate location warning shown if precise location denied

### 2. GPS Accuracy UI (LOCN-02, LOCN-03)

- [ ] GPS accuracy indicator visible in camera UI
- [ ] Indicator shows "good" (green, <10m), "fair" (yellow, <30m), or "poor" (red, >30m)
- [ ] "No signal" shown when GPS unavailable
- [ ] Accuracy value in meters displayed (e.g., "Â±5m")
- [ ] (iOS) "APPROX" badge shown when accuracy >1000m

### 3. Photo Capture with GPS (EVID-01, EVID-02, EVID-03)

- [ ] Photo capture succeeds
- [ ] Photo saved to local storage
- [ ] Photo record in database includes GPS coordinates
- [ ] Photo record includes capture timestamp
- [ ] Photo record includes camera make/model

### 4. EXIF GPS Verification (EVID-01, Critical)

To verify GPS in EXIF, copy a captured photo to computer and check:

**On macOS:**
```bash
# Install exiftool if needed: brew install exiftool
exiftool /path/to/photo.jpg | grep -i gps
```

**Expected output:**
```
GPS Latitude                    : XX deg XX' XX.XX" S
GPS Longitude                   : XXX deg XX' XX.XX" E
GPS Altitude                    : XX m
```

- [ ] GPS Latitude present in EXIF
- [ ] GPS Longitude present in EXIF
- [ ] GPS values match what was displayed in UI

### 5. Location Validation (LOCN-04)

- [ ] Pass propertyLocation prop to CameraCapture component
- [ ] Capture photo when >500m from property location
- [ ] Warning message appears showing distance from property
- [ ] Warning does NOT block photo capture (can still take photo)
- [ ] Warning auto-dismisses after a few seconds

### 6. HEIC Format Handling (PLAT-03)

- [ ] On iOS, captured photos are JPEG format (not HEIC)
- [ ] MIME type correctly recorded as "image/jpeg"

## Test Data for Location Validation

Use these coordinates for testing location validation:

**Auckland CBD:**
- Latitude: -36.8485
- Longitude: 174.7633

**500m away from Auckland CBD:**
- Latitude: -36.8530
- Longitude: 174.7633

Pass one as `propertyLocation` and capture at the other location to test warning.

  </how-to-verify>
  <resume-signal>
Type "verified" if all checklist items pass, or describe any failing items.
  </resume-signal>
</task>

</tasks>

<verification>
All Phase 11 success criteria verified through functional testing.
</verification>

<success_criteria>
- All verification checklist items pass
- GPS coordinates readable in EXIF by external tools (exiftool)
- GPS accuracy indicator visible and accurate
- Location validation alerts work correctly
- Permissions handled properly on both platforms
</success_criteria>

<output>
After completion, create `.planning/phases/11-camera-gps-capture/11-06-SUMMARY.md` with verification results.
</output>
