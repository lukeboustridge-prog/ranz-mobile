---
phase: 14-report-integration
plan: 05
type: execute
wave: 4
depends_on: ["14-01", "14-02", "14-03", "14-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Photos captured on mobile appear in web report builder"
    - "Photo thumbnails load correctly in gallery view"
    - "Hash verification status shows in photo details"
    - "Chain of custody events appear in report audit log"
  artifacts: []
  key_links: []
---

<objective>
Human verification checkpoint for end-to-end mobile-to-web photo sync.

Purpose: Verify that the complete integration works correctly: photos captured on mobile sync to the web platform, appear in the report builder, and chain of custody is preserved.

Output: Verified integration or list of issues to address.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-report-integration/14-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete mobile-to-web photo sync integration:

1. **Web API endpoints:**
   - POST `/api/photos/[id]/confirm-upload` - Updates photo URL after presigned upload
   - POST `/api/sync/custody-events` - Syncs chain of custody events from mobile

2. **Mobile sync updates:**
   - Calls confirm-upload after successful presigned URL upload
   - Syncs custody events to web server
   - Tracks synced vs unsynced custody events

3. **Server-side processing:**
   - Hash verification comparing mobile originalHash to server-computed hash
   - Thumbnail generation (200x200 JPEG) after upload confirmation
   - Audit log entries for photo uploads and custody events

4. **Web UI:**
   - Sync status badges in photo gallery
   - Placeholder for pending uploads
   - Hash verification indicator
  </what-built>
  <how-to-verify>
**Prerequisites:**
- Web app running locally or on staging
- Mobile app running on device/simulator
- Same user logged in to both

**Test 1: Photo Sync Flow**
1. On mobile: Open an existing report or create new one
2. Capture 2-3 photos with GPS location
3. Observe sync status in mobile UI (should show "Synced" after upload)
4. On web: Open the same report in report builder
5. Verify:
   - Photos appear in photo gallery
   - Thumbnails load (not broken images)
   - Sync status badge shows "Synced" with green checkmark
   - Click a photo - hash verification shield should be green

**Test 2: Pending State**
1. On mobile: Put device in airplane mode
2. Capture 1-2 photos
3. On web: Refresh the report (if metadata synced before offline)
4. Verify: Photos show "Pending" badge with clock icon
5. On mobile: Turn off airplane mode, wait for sync
6. On web: Refresh - photos should now show "Synced"

**Test 3: Chain of Custody**
1. On web: Navigate to report audit log (Reports > [Report] > Audit Log)
2. Verify custody events appear:
   - CUSTODY_CAPTURED (photo capture time)
   - CUSTODY_HASHED (hash computation)
   - CUSTODY_STORED (file storage)
   - CUSTODY_SYNCED (upload completion)
3. Verify timestamps are from mobile (original capture time, not sync time)
4. Verify deviceId is present in event details

**Test 4: Hash Verification**
1. On web: Check photo detail view
2. Verify hash verification icon is green (verified)
3. Check audit log for PHOTO_UPLOAD_CONFIRMED entry
4. Verify details include:
   - originalHash (from mobile)
   - computedHash (server verification)
   - hashVerified: true

**Expected Results:**
- All photos sync within 1-2 minutes of coming online
- No broken image icons in gallery
- All custody events have accurate timestamps
- Hash verification passes (hashes match)
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass.

If issues found, describe:
- Which test failed
- Expected vs actual behavior
- Any error messages in console
  </resume-signal>
</task>

</tasks>

<verification>
This is a human verification checkpoint. Success determined by tester.
</verification>

<success_criteria>
- Photos captured on mobile visible in web report builder
- Thumbnails display correctly
- Sync status accurate (synced/pending/error)
- Hash verification passes
- Custody events in audit log with original timestamps
- No data loss during sync
</success_criteria>

<output>
After completion, create `.planning/phases/14-report-integration/14-05-SUMMARY.md`
</output>
