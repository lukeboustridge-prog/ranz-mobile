---
phase: 12-photo-management
plan: 04
type: execute
wave: 2
depends_on: ["12-02"]
files_modified:
  - src/components/PhotoGalleryScreen.tsx
  - src/components/PhotoGalleryHeader.tsx
  - src/components/PhotoGalleryFilters.tsx
  - src/components/index.ts
autonomous: true

must_haves:
  truths:
    - "User can view photos in a gallery with grid or list view"
    - "User can filter photos by type, tag, element, defect"
    - "User can group photos by date, element, tag, or defect"
    - "User can switch between group modes via header tabs"
    - "Gallery displays photo count and applied filter summary"
  artifacts:
    - path: "src/components/PhotoGalleryScreen.tsx"
      provides: "Main gallery screen with filtering, grouping, and navigation"
      min_lines: 200
      exports: ["PhotoGalleryScreen"]
    - path: "src/components/PhotoGalleryHeader.tsx"
      provides: "Gallery header with group mode tabs and view toggle"
      exports: ["PhotoGalleryHeader"]
    - path: "src/components/PhotoGalleryFilters.tsx"
      provides: "Filter sheet with filter options"
      exports: ["PhotoGalleryFilters"]
  key_links:
    - from: "src/components/PhotoGalleryScreen.tsx"
      to: "src/hooks/usePhotoGallery.ts"
      via: "usePhotoGallery hook for state"
      pattern: "usePhotoGallery"
---

<objective>
Create photo gallery screen with organization and filtering UI

Purpose: The main gallery screen where inspectors browse, organize, and find photos. Combines the usePhotoGallery hook with UI for filtering, grouping tabs, and grid/list display. This is the central photo management interface.

Output:
- PhotoGalleryScreen with full photo browsing experience
- PhotoGalleryHeader with group mode tabs
- PhotoGalleryFilters sheet for advanced filtering
- All components exported from components/index.ts
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-photo-management/12-RESEARCH.md
@.planning/phases/12-photo-management/12-02-SUMMARY.md

Key existing code:
@src/components/PhotoGrid.tsx - Existing grid component (use for grid view)
@src/hooks/usePhotoGallery.ts - Gallery state hook from 12-02
@src/types/database.ts - LocalPhoto type
@src/lib/theme.ts - Design system constants
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PhotoGalleryHeader component</name>
  <files>src/components/PhotoGalleryHeader.tsx</files>
  <action>
Create PhotoGalleryHeader.tsx with the following implementation:

1. Props interface:
   ```typescript
   interface PhotoGalleryHeaderProps {
     groupBy: GroupBy;
     onGroupByChange: (groupBy: GroupBy) => void;
     viewMode: 'grid' | 'list';
     onViewModeChange: (mode: 'grid' | 'list') => void;
     photoCount: number;
     filteredCount: number;
     onFilterPress: () => void;
     hasActiveFilters: boolean;
   }
   ```

2. Layout:
   - Top row: Title ("Photos"), filter button with badge, view mode toggle
   - Bottom row: Horizontal scroll of group mode tabs

3. Group mode tabs (horizontal ScrollView):
   - All (groupBy: 'none')
   - By Date (groupBy: 'date')
   - By Element (groupBy: 'element')
   - By Tag (groupBy: 'tag')
   - By Defect (groupBy: 'defect')

4. Filter button:
   - Filter icon
   - Badge showing number of active filters if hasActiveFilters

5. View mode toggle:
   - Grid icon when in list mode (switches to grid)
   - List icon when in grid mode (switches to list)

6. Photo count display:
   - Show "X of Y photos" when filtered
   - Show "X photos" when not filtered

7. Styling:
   - Use theme colors from lib/theme.ts
   - Selected tab has primary color background
   - Unselected tabs have gray background
   - Smooth animation on tab selection
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
Component file exists with PhotoGalleryHeader export.
  </verify>
  <done>PhotoGalleryHeader component created with group tabs, filter button, and view toggle</done>
</task>

<task type="auto">
  <name>Task 2: Create PhotoGalleryFilters component</name>
  <files>src/components/PhotoGalleryFilters.tsx</files>
  <action>
Create PhotoGalleryFilters.tsx as a bottom sheet filter UI:

1. Props interface:
   ```typescript
   interface PhotoGalleryFiltersProps {
     visible: boolean;
     onClose: () => void;
     filters: PhotoFilters;
     onApplyFilters: (filters: PhotoFilters) => void;
     sortOrder: 'asc' | 'desc';
     onSortOrderChange: (order: 'asc' | 'desc') => void;
     // Optional: lists for picker options
     availableDefects?: { id: string; title: string }[];
     availableElements?: { id: string; location: string }[];
   }
   ```

2. Filter sections:

   a. Sort Order:
      - Newest First (desc)
      - Oldest First (asc)
      - Radio button selection

   b. Photo Type filter:
      - Chips for each PhotoType value
      - Multi-select or single-select (implement as single for clarity)
      - "All" option to clear

   c. Quick Tag filter:
      - Chips for: Defect, Good, Inaccessible, Scale, None (null)
      - Single select

   d. Annotations filter:
      - Toggle: "Has Annotations" / "No Annotations" / "Any"

   e. Element filter (if availableElements provided):
      - Picker with available roof elements
      - "Any Element" option

   f. Defect filter (if availableDefects provided):
      - Picker with available defects
      - "Any Defect" option

3. Action buttons:
   - Apply button (primary, calls onApplyFilters)
   - Clear All button (secondary, resets to empty filters)
   - Close button in header

4. Use Modal with slide-up animation.

5. Maintain local filter state until Apply is pressed.
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
Component file exists with PhotoGalleryFilters export.
  </verify>
  <done>PhotoGalleryFilters component created with all filter options and apply/clear actions</done>
</task>

<task type="auto">
  <name>Task 3: Create PhotoGalleryScreen component</name>
  <files>src/components/PhotoGalleryScreen.tsx</files>
  <action>
Create PhotoGalleryScreen.tsx as the main gallery container:

1. Props interface:
   ```typescript
   interface PhotoGalleryScreenProps {
     photos: LocalPhoto[];
     onPhotoPress: (photo: LocalPhoto, index: number) => void;
     onAddPhoto?: () => void;
     showAddButton?: boolean;
     // Optional context for filters
     defects?: { id: string; title: string }[];
     roofElements?: { id: string; location: string }[];
   }
   ```

2. State management:
   - Use usePhotoGallery hook with photos
   - Track viewMode: 'grid' | 'list'
   - Track showFilters: boolean

3. Component structure:
   ```
   SafeAreaView
   ├── PhotoGalleryHeader
   │   (groupBy, viewMode, filters, counts)
   │
   ├── Content Area (conditional on viewMode)
   │   ├── Grid View: FlatList with 3 columns
   │   │   - Use existing PhotoGrid item rendering
   │   │   - Add section headers when grouped
   │   │
   │   └── List View: SectionList
   │       - Section headers for each group
   │       - List items with more detail (caption, metadata)
   │
   ├── Add Photo FAB (if showAddButton)
   │
   └── PhotoGalleryFilters (Modal)
   ```

4. Grid view implementation:
   - Use FlatList with numColumns={3}
   - Render section headers when groupBy !== 'none'
   - Use getItemLayout for performance

5. List view implementation:
   - Use SectionList with groupedPhotos from hook
   - Sticky section headers
   - List item shows: thumbnail, caption, date, tags

6. Empty state:
   - Show friendly message when no photos
   - Different message when filters are active ("No photos match filters")

7. Loading/refresh:
   - Pull-to-refresh if needed (optional for this plan)

8. FAB (Floating Action Button) for Add Photo:
   - Bottom-right position
   - Only shown if showAddButton is true
   - Calls onAddPhoto
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
Component file exists with PhotoGalleryScreen export.
Verify usePhotoGallery hook is imported and used.
  </verify>
  <done>PhotoGalleryScreen component created with grid/list views, header, filters, and FAB</done>
</task>

<task type="auto">
  <name>Task 4: Export all components from index.ts</name>
  <files>src/components/index.ts</files>
  <action>
Add exports for all new gallery components to components/index.ts:

```typescript
export { PhotoGalleryScreen } from "./PhotoGalleryScreen";
export { PhotoGalleryHeader } from "./PhotoGalleryHeader";
export { PhotoGalleryFilters } from "./PhotoGalleryFilters";
```

Place alphabetically with other component exports.
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
Verify components/index.ts includes all three gallery component exports.
  </verify>
  <done>All gallery components exported from components/index.ts</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. All three component files exist with correct exports
3. PhotoGalleryScreen uses usePhotoGallery hook
4. PhotoGalleryHeader has group mode tabs
5. PhotoGalleryFilters has all filter options
6. components/index.ts exports all components
</verification>

<success_criteria>
- PhotoGalleryScreen provides complete gallery browsing experience
- Group mode tabs allow switching between date/element/tag/defect grouping
- Filter sheet provides all filtering options
- Grid and list views both work with proper layout
- Photo counts shown in header
- Empty states handled gracefully
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-photo-management/12-04-SUMMARY.md`
</output>
