---
phase: 12-photo-management
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/usePhotoGallery.ts
  - src/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "Photos can be filtered by photoType, quickTag, defectId, roofElementId, hasAnnotations"
    - "Photos can be grouped by date, element, tag, defect, or none"
    - "Photos can be sorted ascending or descending by capture date"
    - "Grouped photos returned as sections for SectionList"
  artifacts:
    - path: "src/hooks/usePhotoGallery.ts"
      provides: "Photo gallery state management with filtering and grouping"
      exports: ["usePhotoGallery"]
  key_links:
    - from: "src/hooks/usePhotoGallery.ts"
      to: "src/types/database.ts"
      via: "LocalPhoto type import"
      pattern: "import.*LocalPhoto"
---

<objective>
Create photo gallery hook for filtering, sorting, and grouping photos

Purpose: Inspectors need to quickly find specific photos among potentially hundreds captured during an inspection. This hook provides filtering (by type, tag, element, defect, annotations), sorting (by date), and grouping (by date, element, tag) capabilities that power the gallery UI.

Output:
- usePhotoGallery hook with comprehensive filtering and grouping
- Support for SectionList grouped data format
- Hook exported from hooks/index.ts
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-photo-management/12-RESEARCH.md

Key existing code:
@src/types/database.ts - LocalPhoto type
@src/types/shared.ts - PhotoType, QuickTag, ElementType enums
@src/hooks/index.ts - Hook exports
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create usePhotoGallery hook</name>
  <files>src/hooks/usePhotoGallery.ts</files>
  <action>
Create usePhotoGallery.ts with the following implementation:

1. Define PhotoFilters interface:
   ```typescript
   interface PhotoFilters {
     photoType?: PhotoType;
     quickTag?: QuickTag;
     elementType?: ElementType;
     defectId?: string;
     roofElementId?: string;
     hasAnnotations?: boolean;
     dateRange?: { start: Date; end: Date };
   }
   ```

2. Define GroupedPhotos interface for SectionList:
   ```typescript
   interface PhotoSection {
     title: string;      // "Today", "Yesterday", "7 Feb 2026"
     data: LocalPhoto[];
   }
   ```

3. Define GroupBy type:
   ```typescript
   type GroupBy = 'date' | 'element' | 'tag' | 'defect' | 'none';
   ```

4. Implement usePhotoGallery hook:
   ```typescript
   export function usePhotoGallery(
     allPhotos: LocalPhoto[],
     initialFilters?: PhotoFilters
   )
   ```

5. Hook should return:
   - photos: LocalPhoto[] (filtered and sorted)
   - groupedPhotos: PhotoSection[] (for SectionList)
   - filters: PhotoFilters (current filters)
   - setFilters: (filters: PhotoFilters) => void
   - groupBy: GroupBy
   - setGroupBy: (groupBy: GroupBy) => void
   - sortOrder: 'asc' | 'desc'
   - setSortOrder: (order: 'asc' | 'desc') => void
   - totalCount: number (all photos before filtering)
   - filteredCount: number (photos after filtering)
   - clearFilters: () => void

6. Implement filtering logic:
   - Filter by photoType if specified
   - Filter by quickTag if specified
   - Filter by defectId if specified
   - Filter by roofElementId if specified
   - Filter by hasAnnotations (check annotationsJson is not null and not '[]')

7. Implement sorting logic:
   - Sort by capturedAt or createdAt date
   - Support ascending and descending order

8. Implement grouping logic with formatDateGroup helper:
   - 'date': Group by date (Today, Yesterday, or formatted date)
   - 'element': Group by roofElementId (or 'General' if null)
   - 'tag': Group by quickTag (or 'Untagged' if null)
   - 'defect': Group by defectId (or 'General' if null)
   - 'none': Single group with all photos

9. Use useMemo for all derived data to prevent unnecessary recalculations.

Include comprehensive JSDoc comments explaining the hook usage.
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
Check all exported types and functions are present.
  </verify>
  <done>usePhotoGallery hook created with filtering, sorting, grouping, and SectionList support</done>
</task>

<task type="auto">
  <name>Task 2: Export hook from hooks/index.ts</name>
  <files>src/hooks/index.ts</files>
  <action>
Add export for usePhotoGallery to hooks/index.ts:

```typescript
export { usePhotoGallery } from "./usePhotoGallery";
export type { PhotoFilters, PhotoSection, GroupBy } from "./usePhotoGallery";
```

Ensure the types are also exported so consumers can use them for type annotations.
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
Verify hooks/index.ts includes usePhotoGallery export.
  </verify>
  <done>usePhotoGallery exported from hooks/index.ts with types</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. usePhotoGallery.ts exists with all documented exports
3. hooks/index.ts exports usePhotoGallery and types
4. Hook signature matches specification
</verification>

<success_criteria>
- usePhotoGallery hook created with full filtering capability
- Grouping supports date, element, tag, defect, and none modes
- Sorting supports ascending and descending by capture date
- Output compatible with SectionList (PhotoSection[] format)
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-photo-management/12-02-SUMMARY.md`
</output>
