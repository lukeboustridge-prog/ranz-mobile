---
phase: 15-production-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - eas.json
  - app.json
autonomous: true

must_haves:
  truths:
    - "EAS Build configuration exists with development, preview, and production profiles"
    - "Production builds use app-bundle for Android and store distribution for iOS"
    - "Build numbers auto-increment in production profile"
    - "Each profile has correct EXPO_PUBLIC_APP_ENV value"
  artifacts:
    - path: "eas.json"
      provides: "EAS Build profiles for dev, preview, production"
      min_lines: 40
    - path: "app.json"
      provides: "Valid EAS project ID"
      contains: "projectId"
  key_links:
    - from: "eas.json"
      to: "app.json"
      via: "projectId reference"
      pattern: "projectId"
---

<objective>
Create EAS Build configuration for development, preview, and production builds.

Purpose: Enable building the app for internal testing (preview) and app store submission (production). EAS Build handles iOS signing, Android keystores, and cloud builds.

Output: Complete eas.json with three build profiles, updated app.json with real EAS project ID.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-production-polish/15-RESEARCH.md

@app.json
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create eas.json with build profiles</name>
  <files>eas.json</files>
  <action>
Create `eas.json` in the project root with three build profiles:

```json
{
  "cli": {
    "version": ">= 15.0.0",
    "appVersionSource": "remote"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "ios": {
        "simulator": true
      },
      "android": {
        "buildType": "apk"
      },
      "env": {
        "EXPO_PUBLIC_APP_ENV": "development"
      }
    },
    "preview": {
      "distribution": "internal",
      "ios": {
        "simulator": false,
        "resourceClass": "m-medium"
      },
      "android": {
        "buildType": "apk"
      },
      "env": {
        "EXPO_PUBLIC_APP_ENV": "preview"
      },
      "channel": "preview"
    },
    "production": {
      "distribution": "store",
      "autoIncrement": "buildNumber",
      "ios": {
        "resourceClass": "m-medium"
      },
      "android": {
        "buildType": "app-bundle"
      },
      "env": {
        "EXPO_PUBLIC_APP_ENV": "production"
      },
      "channel": "production"
    }
  },
  "submit": {
    "production": {}
  }
}
```

Key configuration decisions:
- `appVersionSource: "remote"` - EAS manages version numbers
- `autoIncrement: "buildNumber"` - Prevents app store conflicts
- `buildType: "apk"` for dev/preview (faster installs), `app-bundle` for production (smaller)
- `resourceClass: "m-medium"` - Balanced build time vs cost for iOS
- `channel` specified for OTA updates readiness (EAS Update)
  </action>
  <verify>
Validate JSON syntax:
```bash
cd /c/Users/LukeBoustridge/Projects/RANZ/RANZ\ Roofing\ Report/ranz-mobile && node -e "JSON.parse(require('fs').readFileSync('eas.json'))"
```
  </verify>
  <done>
eas.json exists with development, preview, and production profiles. Each profile has appropriate distribution, build type, and environment variables.
  </done>
</task>

<task type="auto">
  <name>Task 2: Initialize EAS project and update app.json</name>
  <files>app.json</files>
  <action>
Initialize EAS project to get a real project ID:

1. Run EAS init (this registers the project with Expo):
```bash
npx eas-cli init
```

This will:
- Register the project with Expo (using existing expo account or prompting for login)
- Create/update the projectId in app.json
- Configure the project for EAS Build

2. If eas-cli prompts for project selection, choose "Create a new project" and use "ranz-mobile"

3. Verify app.json was updated with a real projectId (not "your-project-id")

4. If init fails due to auth, add a note in the summary that user needs to run `npx eas-cli login` first, then re-run init.

After init, verify the projectId in app.json looks like a UUID (e.g., "12345678-1234-1234-1234-123456789abc"), not the placeholder.
  </action>
  <verify>
```bash
cd /c/Users/LukeBoustridge/Projects/RANZ/RANZ\ Roofing\ Report/ranz-mobile && grep -o '"projectId": "[^"]*"' app.json
```
Check that projectId is not "your-project-id" placeholder.
  </verify>
  <done>
app.json contains a valid EAS projectId. Project is registered with Expo for EAS Build.
  </done>
</task>

</tasks>

<verification>
1. eas.json exists and is valid JSON
2. Three build profiles exist: development, preview, production
3. Production uses store distribution and app-bundle
4. app.json has real EAS projectId (not placeholder)
5. EXPO_PUBLIC_APP_ENV is set in each profile
</verification>

<success_criteria>
- `eas.json` with valid development, preview, production profiles
- `app.json` updated with real EAS projectId
- Ready to run `eas build --profile preview` for internal testing
- Auto-increment configured for production builds
</success_criteria>

<output>
After completion, create `.planning/phases/15-production-polish/15-01-SUMMARY.md`
</output>
